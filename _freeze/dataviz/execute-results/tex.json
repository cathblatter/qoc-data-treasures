{
  "hash": "cc31065da9ac5ed954e0cdc62e1d776a",
  "result": {
    "markdown": "# Visualising data\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## Prepare data for visualisation\n\nConsider the example from class where four people (A, B, C, D) were asked \nabout their tool-preferences for accessing their e-banking account: \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\\begin{table}\n\n\\caption{\\label{tab:unnamed-chunk-2}Tidy dataframe - wide format}\n\\centering\n\\begin{tabular}[t]{l|l|l}\n\\hline\nperson\\_id & uses\\_phone & uses\\_computer\\\\\n\\hline\nA & yes & no\\\\\n\\hline\nB & yes & yes\\\\\n\\hline\nC & yes & no\\\\\n\\hline\nD & no & yes\\\\\n\\hline\n\\end{tabular}\n\\end{table}\n:::\n:::\n\n\n\n- Formally, this dataframe is in 'tidy' format and the unit of analysis is the \n  `person_id`\n  \nNow we represent the same information in a barchart, to compare the frequencies: \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-3-1.pdf)\n:::\n:::\n\n\n\nBut how did we actually input the data? If we try this \nwe only get the variable `uses_computer` on the x-axis (with the values no and yes): \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = wldf, aes(x = uses_computer)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-4-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nWhen we go back to the original plot: \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-5-1.pdf)\n:::\n:::\n\n\n\n-  we see that we want a variable `tool` on the x-axis, that has the values 'uses_computer' and 'uses_phone' \n\n- we want a variable `answer` that has the values 'no' and 'yes'\n\n(- we possibly want a variable `percentage` on the y-axis, that has numeric values \n according to the proportions)\n \n - In summary, the format of the data needs to change in order to plot\n \n## Option 1: wide-to-long a.k.a stack \n \n In this option we use `tidyr::pivot_longer()` to create a dataframe in long format:\n \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# we want to stack the columns uses_computer and uses_phone\nlong_df <- \n  wldf %>% \n  pivot_longer(cols = c(uses_computer, uses_phone), \n               names_to = \"tool\", \n               values_to = \"answer\") \n\n# print the df\nlong_df\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 x 3\n  person_id tool          answer\n  <chr>     <chr>         <chr> \n1 A         uses_computer no    \n2 A         uses_phone    yes   \n3 B         uses_computer yes   \n4 B         uses_phone    yes   \n5 C         uses_computer no    \n6 C         uses_phone    yes   \n7 D         uses_computer yes   \n8 D         uses_phone    no    \n```\n:::\n:::\n\n\n \n - this dataframe now has the variable `tool` and `answer` for the ggplot2-code \n  using `geom_bar(position = \"fill)` : \n \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(long_df, aes(x = tool, fill = answer)) +\n  geom_bar(position = \"fill\")\n```\n\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-7-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n \n - of course, this needed some further 'layout-work' to improve the labeling of scales \n and the removal of the grey-background\n \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(long_df, aes(x = tool, fill = answer)) +\n  geom_bar(position = \"fill\") +\n  scale_y_continuous(name = NULL, \n                     labels = scales::percent) +\n  theme_minimal() +\n  theme(text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Option 2: Aggregation of values before plotting\n\nAnother option is to aggregate (or summarise) values manually, before we pass them \nto a plotting function (the example above is not really a good example for this), \nbut the code might be handy if you have more variables than 2 for this situation.\n\nIn the example, we'd need to have three variables as indicated above: `tool` (for the x-axis), `answer` for the fill and `percent` for the percentage. We can create this \ntable with: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nagg_data <- \n  wldf |> \n  select(uses_computer, uses_phone) |> \n  as.list() |> \n  map_dfr(~janitor::tabyl(.x), .id = \"tool\") |> \n  rename(answer = .x)\n\n# print agg_data\nagg_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          tool answer n percent\n uses_computer     no 2    0.50\n uses_computer    yes 2    0.50\n    uses_phone     no 1    0.25\n    uses_phone    yes 3    0.75\n```\n:::\n:::\n\n\n\nAnd then we can plot it: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = agg_data, aes(x = tool, y = percent, fill = answer)) +\n  geom_col(position = \"stack\")\n```\n\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n- Careful: instead of using `geom_bar(position=\"fill\")` without a y-variable, here \n  we pass the `percent`-value to the y-axis and use `geom_col(position=\"stack\")` \n  for the `answer`-variable\n\nAn finally, improve the layout: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = agg_data, aes(x = tool, y = percent, fill = answer)) +\n  geom_col(position = \"stack\") + \n  scale_y_continuous(name = NULL, \n                     labels = scales::percent) +\n  theme_minimal() +\n  theme(text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](dataviz_files/figure-pdf/unnamed-chunk-11-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "dataviz_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"normalem\"]},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}